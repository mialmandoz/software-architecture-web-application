<!-- Centered Title -->
<div class="text-center mb-8">
  <h1 class="text-4xl font-bold text-base-content">ğŸ’° Sales by Year</h1>
  <p class="mt-2 text-base-content/70">Track book sales data and performance by year</p>
</div>

<!-- Action Button -->
<div class="flex justify-center mb-6">
  <.link href={~p"/sales/new"}>
    <.button class="btn btn-success btn-lg">
      ğŸ’° New Sale Record
    </.button>
  </.link>
</div>

<!-- Filter Form -->
<div class="mb-6 p-4 border border-gray-300 rounded-lg bg-gray-50">
  <.form
    :let={f}
    for={%{}}
    action={~p"/sales"}
    method="get"
    class="flex flex-col sm:flex-row items-center gap-4"
  >
    <div class="flex-1">
      <.input
        field={f[:filter_book]}
        type="text"
        placeholder="Filter by book name..."
        value={@filter_book}
        name="filter_book"
        class="w-full text-lg px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200"
      />
    </div>
    <div class="flex-1">
      <.input
        field={f[:filter_author]}
        type="text"
        placeholder="Filter by author..."
        value={@filter_author}
        name="filter_author"
        class="w-full text-lg px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200"
      />
    </div>
    <div class="flex-1">
      <.input
        field={f[:filter_year]}
        type="text"
        placeholder="Filter by year..."
        value={@filter_year}
        name="filter_year"
        class="w-full text-lg px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200"
      />
    </div>
    <.button type="submit" class="btn btn-primary btn-lg">
      ğŸ” Filter
    </.button>
    <%= if @filter_book != "" or @filter_year != "" or @filter_author != "" do %>
      <.link href={~p"/sales"} class="text-sm text-gray-500 hover:text-gray-700">
        Clear Filters
      </.link>
    <% end %>
  </.form>
</div>

<.table id="sales" rows={@sales} row_click={&JS.navigate(~p"/sales/#{&1}")}>
  <:col
    :let={sale}
    label={
      raw(
        ~s(<a href="#{book_sort_path(@params)}" class="flex items-center hover:text-purple-600">
      Book
      #{if @params["sort_by"] == "book_name" do
          if @params["sort_order"] == "desc" do
            ~s(<span class="ml-1">â†“</span>)
          else
            ~s(<span class="ml-1">â†‘</span>)
          end
        else
          ~s(<span class="ml-1 text-gray-400">â†•</span>)
        end}
    </a>)
      )
    }
  >
    {sale.book.name}
  </:col>
  <:col
    :let={sale}
    label={
      raw(~s(<a href="#{book_sort_path(@params)}" class="flex items-center hover:text-purple-600">
      Author
    </a>))
    }
  >
    {if sale.book.author, do: sale.book.author.name, else: "Unknown"}
  </:col>
  <:col
    :let={sale}
    label={
      raw(~s(<a href="#{book_sort_path(@params)}" class="flex items-center hover:text-purple-600">
      Year
    </a>))
    }
  >
    {sale.year}
  </:col>
  <:col
    :let={sale}
    label={
      raw(~s(<a href="#{book_sort_path(@params)}" class="flex items-center hover:text-purple-600">
      Sales
    </a>))
    }
  >
    ğŸ“Š {format_sales(sale.sales)}
  </:col>
  <:action :let={sale}>
    <div class="sr-only">
      <.link navigate={~p"/sales/#{sale}"}>Show</.link>
    </div>
    <.link navigate={~p"/sales/#{sale}/edit"}>Edit</.link>
  </:action>
  <:action :let={sale}>
    <.link href={~p"/sales/#{sale}"} method="delete" data-confirm="Are you sure?">
      Delete
    </.link>
  </:action>
</.table>

<!-- Pagination -->
<%= if @page.total_pages > 1 do %>
  <.pagination
    page={@page}
    path={~p"/sales"}
    params={
      %{
        "filter_book" => @filter_book,
        "filter_year" => @filter_year,
        "filter_author" => @filter_author
      }
    }
  />
<% end %>

<!-- Empty State -->
<%= if Enum.empty?(@sales) do %>
  <div class="text-center py-12">
    <div class="text-6xl mb-4">ğŸ’°</div>
    <h3 class="text-lg font-medium text-base-content mb-2">No sales found</h3>
    <p class="text-base-content/60">
      <%= if @filter_book != "" or @filter_year != "" or @filter_author != "" do %>
        No sales match your search criteria. Try adjusting your filters.
      <% else %>
        There are no sales records in the system yet.
      <% end %>
    </p>
  </div>
<% end %>
