<!-- Centered Title -->
<div class="text-center mb-8">
  <h1 class="text-4xl font-bold text-base-content">⭐ Reviews</h1>
  <p class="mt-2 text-base-content/70">Read and write book reviews with star ratings</p>
</div>

<!-- Action Button -->
<div class="flex justify-center gap-4 mb-6">
  <.link href={~p"/reviews/new"}>
    <.button class="btn btn-success btn-lg">⭐ New Review</.button>
  </.link>
  <%= if @search_available do %>
    <.link href={~p"/reviews/search"}>
      <.button class="btn btn-info btn-lg">🔍 Advanced Search</.button>
    </.link>
  <% end %>
</div>

<!-- Filter Form -->
<div class="mb-6 p-4 border border-gray-300 rounded-lg bg-gray-50">
  <.form
    :let={f}
    for={%{}}
    action={~p"/reviews"}
    method="get"
    class="flex flex-col sm:flex-row items-center gap-4"
  >
    <div class="flex-1">
      <.input
        field={f[:filter_book]}
        type="text"
        placeholder="Filter by book name..."
        value={@filter_book}
        name="filter_book"
        class="w-full text-lg px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200"
      />
    </div>
    <.button type="submit" class="btn btn-primary btn-lg">
      🔍 Filter
    </.button>
    <%= if @filter_book != "" do %>
      <.link href={~p"/reviews"} class="text-sm text-gray-500 hover:text-gray-700">
        Clear Filters
      </.link>
    <% end %>
  </.form>
</div>

<.table id="reviews" rows={@reviews} row_click={&JS.navigate(~p"/reviews/#{&1}")}>
  <:col :let={review} label="Book">{review.book.name}</:col>
  <:col :let={review} label="Rating">
    <span class="text-yellow-500">
      {star_rating(review.score)}
    </span>
  </:col>
  <:col :let={review} label="Review">
    <%= if String.length(review.review) > 100 do %>
      {String.slice(review.review, 0, 100)}...
    <% else %>
      {review.review}
    <% end %>
  </:col>
  <:col :let={review} label="Upvotes">
    👍 {review.number_of_upvotes}
  </:col>
  <:action :let={review}>
    <div class="sr-only">
      <.link navigate={~p"/reviews/#{review}"}>Show</.link>
    </div>
    <.link navigate={~p"/reviews/#{review}/edit"}>Edit</.link>
  </:action>
  <:action :let={review}>
    <.link href={~p"/reviews/#{review}"} method="delete" data-confirm="Are you sure?">
      Delete
    </.link>
  </:action>
</.table>

<!-- Pagination -->
<%= if @page.total_pages > 1 do %>
  <.pagination
    page={@page}
    path={~p"/reviews"}
    params={%{"filter_book" => @filter_book}}
  />
<% end %>

<!-- Empty State -->
<%= if Enum.empty?(@reviews) do %>
  <div class="text-center py-12">
    <div class="text-6xl mb-4">⭐</div>
    <h3 class="text-lg font-medium text-base-content mb-2">No reviews found</h3>
    <p class="text-base-content/60">
      <%= if @filter_book != "" do %>
        No reviews match your search criteria. Try adjusting your filters.
      <% else %>
        There are no reviews in the system yet.
      <% end %>
    </p>
  </div>
<% end %>
