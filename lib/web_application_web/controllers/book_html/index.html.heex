<!-- Centered Title -->
<div class="text-center mb-8">
  <h1 class="text-4xl font-bold text-base-content">📚 Books</h1>
  <p class="mt-2 text-base-content/70">Explore our collection of literary works</p>
</div>

<!-- Action Buttons -->
<div class="flex justify-center gap-4 mb-6">
  <.link href={~p"/books/new"}>
    <.button class="btn btn-success btn-lg">✍️ New Book</.button>
  </.link>
  <%= if @search_available do %>
    <.link href={~p"/books/search"}>
      <.button class="btn btn-info btn-lg">🔍 Advanced Search</.button>
    </.link>
  <% end %>
  <.link href={~p"/books/top-rated"}>
    <.button class="btn btn-warning btn-lg">
      🏆 Top 10 Rated Books
    </.button>
  </.link>
  <.link href={~p"/books/top-selling"}>
    <.button class="btn btn-secondary btn-lg">
      📈 Top 50 Selling Books
    </.button>
  </.link>
</div>

<!-- Filter Form -->
<div class="mb-6 p-4 border border-gray-300 rounded-lg bg-gray-50">
  <.form
    :let={f}
    for={%{}}
    action={~p"/books"}
    method="get"
    class="flex flex-col sm:flex-row items-center gap-4"
  >
    <div class="flex-1">
      <.input
        field={f[:filter_name]}
        type="text"
        placeholder="Filter by book title..."
        value={@filter_name}
        name="filter_name"
        class="w-full text-lg px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200"
      />
    </div>
    <div class="flex-1">
      <.input
        field={f[:filter_author]}
        type="text"
        placeholder="Filter by author name..."
        value={@filter_author}
        name="filter_author"
        class="w-full text-lg px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200"
      />
    </div>
    <div class="flex-1">
      <.input
        field={f[:filter_summary]}
        type="text"
        placeholder="Search book summaries..."
        value={@filter_summary}
        name="filter_summary"
        class="w-full text-lg px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200"
      />
    </div>
    <.button type="submit" class="btn btn-primary btn-lg">
      🔍 Filter
    </.button>
    <%= if @filter_name != "" or @filter_author != "" or @filter_summary != "" do %>
      <.link href={~p"/books"} class="text-sm text-gray-500 hover:text-gray-700">
        Clear Filters
      </.link>
    <% end %>
  </.form>
</div>

<.table id="books" rows={@books} row_click={&JS.navigate(~p"/books/#{&1}")}>
  <:col :let={book} label="Name">{book.name}</:col>
  <:col :let={book} label="Author">
    {if book.author, do: book.author.name, else: "Unknown"}
  </:col>
  <:col :let={book} label="Publication Date">
    {if book.date_of_publication,
      do: Calendar.strftime(book.date_of_publication, "%B %d, %Y"),
      else: "Not set"}
  </:col>
  <:col :let={book} label="Sales">{book.number_of_sales}</:col>
  <:col :let={book} label="Summary">
    <%= if book.summary && String.length(book.summary) > 100 do %>
      {String.slice(book.summary, 0, 100)}...
    <% else %>
      {book.summary}
    <% end %>
  </:col>
  <:action :let={book}>
    <div class="sr-only">
      <.link navigate={~p"/books/#{book}"}>Show</.link>
    </div>
    <.link navigate={~p"/books/#{book}/edit"}>Edit</.link>
  </:action>
  <:action :let={book}>
    <.link href={~p"/books/#{book}"} method="delete" data-confirm="Are you sure?">
      Delete
    </.link>
  </:action>
</.table>

<!-- Pagination -->
<%= if @page.total_pages > 1 do %>
  <.pagination
    page={@page}
    path={~p"/books"}
    params={
      %{
        "filter_name" => @filter_name,
        "filter_author" => @filter_author,
        "filter_summary" => @filter_summary
      }
    }
  />
<% end %>

<!-- Empty State -->
<%= if Enum.empty?(@books) do %>
  <div class="text-center py-12">
    <div class="text-6xl mb-4">📖</div>
    <h3 class="text-lg font-medium text-base-content mb-2">No books found</h3>
    <p class="text-base-content/60">
      <%= if @filter_name != "" or @filter_author != "" or @filter_summary != "" do %>
        No books match your search criteria. Try adjusting your filters.
      <% else %>
        There are no books in the system yet.
      <% end %>
    </p>
  </div>
<% end %>
